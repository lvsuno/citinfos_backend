# Rubrique Structure - October 16, 2025

## Overview

Successfully recreated the complete rubrique structure with 32 rubriques organized in a hierarchical parent-child relationship.

## Statistics

- **Total Rubriques**: 32
- **Parent Sections**: 10
- **Child Rubriques**: 22
- **Communities Updated**: 3 (all communities enabled with all rubriques)

## Complete Structure

### 1. Accueil (001)
- **Type**: `accueil`
- **Icon**: Home
- **Children**: None
- **Description**: Main dashboard/home page

### 2. Nouvelles (002)
- **Type**: `nouvelles`
- **Icon**: Article
- **Children**: 2
  - **2.1** Actualités (002.001) - `actualites` - FiberNew
  - **2.2** Annonces (002.002) - `annonces` - Campaign

### 3. Services (003)
- **Type**: `services_section`
- **Icon**: HomeRepairService
- **Children**: 3
  - **3.1** Services municipaux (003.001) - `services` - AccountBalance
  - **3.2** Transport (003.002) - `transport` - DirectionsBus
  - **3.3** Commerces (003.003) - `commerces` - Storefront

### 4. Culture (004)
- **Type**: `culture_section`
- **Icon**: TheaterComedy
- **Children**: 4
  - **4.1** Événements culturels (004.001) - `culture` - Event
  - **4.2** Littérature (004.002) - `litterature` - MenuBook
  - **4.3** Poésie (004.003) - `poesie` - AutoStories
  - **4.4** Histoire (004.004) - `histoire` - HistoryEdu

### 5. Économie (005)
- **Type**: `economie_section`
- **Icon**: TrendingUp
- **Children**: 2
  - **5.1** Développement économique (005.001) - `economie` - Business
  - **5.2** Opportunités (005.002) - `opportunites` - WorkOutline

### 6. Art (006)
- **Type**: `art_section`
- **Icon**: Palette
- **Children**: 2
  - **6.1** Créations artistiques (006.001) - `art` - Brush
  - **6.2** Expositions (006.002) - `expositions` - Museum

### 7. Sports (007)
- **Type**: `sports_section`
- **Icon**: FitnessCenter
- **Children**: 2
  - **7.1** Activités sportives (007.001) - `sport` - DirectionsRun
  - **7.2** Événements sportifs (007.002) - `evenements_sportifs` - EmojiEvents

### 8. Distinction (008)
- **Type**: `distinction_section`
- **Icon**: Stars
- **Children**: 2
  - **8.1** Reconnaissances (008.001) - `reconnaissance` - CardGiftcard
  - **8.2** Prix et honneurs (008.002) - `prix` - MilitaryTech

### 9. Photos et Vidéos (009)
- **Type**: `photos_videos_section`
- **Icon**: PermMedia
- **Children**: 2
  - **9.1** Galerie photos (009.001) - `photographie` - PhotoLibrary
  - **9.2** Vidéos (009.002) - `videos` - VideoLibrary

### 10. Participation Citoyenne (010)
- **Type**: `participation_section`
- **Icon**: HowToVote
- **Children**: 3
  - **10.1** Consultations (010.001) - `consultations` - QuestionAnswer
  - **10.2** Suggestions (010.002) - `suggestions` - Lightbulb
  - **10.3** Événements (010.003) - `evenements` - CalendarToday

## Technical Details

### Materialized Path Pattern

The rubriques use a materialized path pattern for efficient hierarchical queries:
- **Parent paths**: `001`, `002`, `003`, etc.
- **Child paths**: `002.001`, `002.002`, `003.001`, etc.

Paths are auto-generated by the `RubriqueTemplate.save()` method based on the `default_order` field.

### Database Schema

```python
class RubriqueTemplate(models.Model):
    id = UUIDField
    template_type = CharField (unique)
    default_name = CharField
    default_icon = CharField (Material-UI icon name)
    default_order = IntegerField (used to generate path)
    parent = ForeignKey (self, nullable)
    depth = IntegerField (0 for parents, 1 for children)
    path = CharField (materialized path)
    is_active = BooleanField
```

### API Endpoints

1. **GET /api/communities/{slug}/rubriques/**
   - Returns hierarchical tree structure of enabled rubriques
   - Public endpoint (no authentication required)
   - Response includes parent sections with nested children

2. **GET /api/communities/{slug}/posts/accueil/**
   - Returns all posts in the community
   - Ordered by creation date (newest first)

3. **GET /api/communities/{slug}/rubriques/{type}/posts/**
   - Returns posts filtered by rubrique type
   - Includes both direct posts and posts within threads of that rubrique

## Frontend Integration

The frontend should:

1. **Fetch rubriques** from `/api/communities/{slug}/rubriques/`
2. **Map Material-UI icons** using the `icon` field
3. **Display hierarchical structure** respecting parent-child relationships
4. **Use `template_type`** as the URL path for navigation
5. **Cache results** for 5 minutes to reduce API calls

### Icon Mapping

All icons are Material-UI icon names:
- Home, Article, FiberNew, Campaign, HomeRepairService, etc.
- Frontend should map these strings to actual MUI icon components

## Migration Script

The `recreate_rubriques_final.py` script:

1. ✅ Clears rubrique references from existing posts/threads
2. ✅ Deletes all existing rubriques
3. ✅ Creates 32 new rubriques with correct `default_order`
4. ✅ Sets parent-child relationships
5. ✅ Updates all communities with new rubrique IDs
6. ✅ Paths are auto-generated correctly by the save() method

## Next Steps

- [ ] Update frontend icon mapping to include new icons
- [ ] Test navigation between rubriques
- [ ] Verify post filtering works correctly
- [ ] Consider adding rubrique descriptions to the UI
- [ ] Optionally reassign existing posts to appropriate rubriques
